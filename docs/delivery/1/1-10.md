# 1-10 Flow Node Auto-Creation in Link API

## Description
Update the API link creation handler to detect when a flow node is required (e.g., when linking accumulators) and create it automatically, matching UI logic. This ensures programmatic model construction matches user affordances and produces valid, runnable models.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|-----------|-------------|-----------|---------|------|
| 2025-06-25 12:00:00 | Created | N/A | Proposed | Task drafted for flow node auto-creation in link API | ai-agent |
| 2025-06-25 15:20:00 | Status Change | Proposed | Agreed | Task approved by Product Owner | Chad |
| 2025-06-25 15:45:00 | Status Change | Agreed | Done | Implementation, test interface, and verification complete. API link creation auto-generates flow node as needed; verified via test page. | ai-agent |

## Requirements
- Detect accumulator-to-accumulator or other cases requiring a flow node.
- Create flow node and link as a single atomic operation.
- Return all affected node/link IDs in the API response.
- Ensure undo/redo stack records the composite operation.
- Add tests for all relevant scenarios.

## Implementation Plan
1. Review UI logic for flow node auto-creation.
2. Refactor or expose this logic for API use.
3. Update API handler to invoke auto-creation as needed.
4. Update response schema to include new node/link IDs.
5. Add comprehensive tests.

## Verification
- API-created links behave identically to UI-created links, including auto-creation of flows.
- All relevant tests pass.

## Files Modified
- src/code/sage-api.ts
- src/code/models/graph-store.ts
- Documentation as needed

[Back to task list](./tasks.md) 